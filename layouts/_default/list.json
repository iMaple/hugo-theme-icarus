{{- .Scratch.Add "categories" slice -}}
{{- range .Site.Taxonomies.categories -}}
{{- $.Scratch.Add "categories" (dict "name" .Page.Title "link" .Page.Permalink ) -}}
{{- end -}}

{{- .Scratch.Add "tags" slice -}}
{{- range .Site.Taxonomies.tags -}}
{{- $.Scratch.Add "tags" (dict "name" .Page.Title "link" .Page.Permalink) -}}
{{- end -}}

{{- .Scratch.Add "posts" slice -}}
{{- range $index, $value := (where .Site.RegularPages "Section" "==" "posts") -}}
{{- $.Scratch.Add "posts" (dict "id" $index "title" $value.Title "link" $value.Permalink "tags" $value.Params.tags "section" $value.Section "content" $value.Plain "summary" $value.Summary "year" ($value.Date.Format "2006")) -}}
{{- end -}}

{{- .Scratch.SetInMap "index" "posts" (.Scratch.Get "posts") }}
{{- .Scratch.SetInMap "index" "tags" (.Scratch.Get "tags") }}
{{- .Scratch.SetInMap "index" "categories" (.Scratch.Get "categories") }}
{{- .Scratch.Get "index" | jsonify -}}

{{- .Scratch.Delete "posts" -}}
{{- .Scratch.Delete "tags" -}}
{{- .Scratch.Delete "categories" -}}
{{- .Scratch.Delete "index" -}}
